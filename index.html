<!DOCTYPE html>
<html>
<head>
    <title>Floating-point unit test</title>
    <style>
        /*  */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 20px; 
            background-color: #333333; /*  */
            color: #dddddd; /*  */
        }
        h3 { 
            color: #e74c3c; /* */
            border-bottom: 2px solid #e74c3c; 
            padding-bottom: 5px; 
        }
        
        /*  */
        #output { 
            background-color: #cccccc; /*  */
            border-radius: 8px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.5); 
            padding: 20px; 
            margin-top: 20px; 
            color: #333333; /*  */
        }
        .test-result-list { margin-bottom: 15px; max-height: 250px; overflow-y: auto; padding-right: 10px; }
        .test-result-list p { margin: 2px 0; font-size: 0.9em; }
        
        table { border-collapse: collapse; width: 100%; margin-top: 15px; font-size: 0.9em; }
        th, td { border: 1px solid #e0e0e0; padding: 10px; text-align: left; }
        th { background-color: #b0b0b0; color: #333; font-weight: 600; } 
        td { color: #333; }
        
        .cv-value { font-size: 1.4em; font-weight: bold; margin-right: 10px; }
        .evaluation-box { 
            padding: 10px; 
            border-radius: 6px; 
            margin-top: 15px; 
            border-left: 5px solid; 
        }

        .success { color: #2ecc71; border-color: #2ecc71; background-color: #e8f8f2; }
        .warning { color: #f39c12; border-color: #f39c12; background-color: #fcf4e3; }
        .critical { color: #e74c3c; border-color: #e74c3c; background-color: #fbecec; }

        .summary-details { margin-top: 15px; border-top: 1px dashed #777; padding-top: 10px; }
        
        #startButton {
            color: #333;
        }
    </style>
</head>
<body>

<h3>Floating-point unit test</h3>
<p>–ù–∞–∂–º–∏—Ç–µ Start Test –¥–ª—è –∑–∞–ø—É—Å–∫–∞.</p>
<button id="startButton" onclick="startJitterTest(20)">‚ñ∂Ô∏è Start Test</button>

<div id="output" class="result-box">
    –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞...
</div>

<script>
const OPERATIONS = 5000000; 

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

async function startJitterTest(iterations = 20) {
    const output = document.getElementById('output');
    const startButton = document.getElementById('startButton');
    
    startButton.disabled = true;
    output.innerHTML = '<h4>–ò–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤... (–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ)</h4><div class="test-result-list"></div>';
    
    const resultListDiv = output.querySelector('.test-result-list');
    const results = [];
    
    for(let iter = 0; iter < iterations; iter++) {
        const t0 = performance.now();
        
        let r1 = 0, r2 = 0, r3 = 0, r4 = 0;
        for(let i = 0; i < OPERATIONS; i++) {
            const x = i * 0.001;
            r1 += Math.sin(x) * Math.cos(x);
            r2 += Math.tan(x * 0.1) * Math.atan(x);
            r3 += Math.exp(x * 0.01) * Math.log(Math.abs(x) + 1);
            r4 += Math.sqrt(i + 1) * Math.cbrt(i + 1);
        }
        
        const t1 = performance.now();
        const duration = t1 - t0;
        
        results.push(duration);
        resultListDiv.innerHTML += `<p>–¢–µ—Å—Ç ${iter + 1}: <b>${duration.toFixed(1)} –º—Å</b></p>`;
        
        // 
        resultListDiv.scrollTop = resultListDiv.scrollHeight; 
        
        if(iter < iterations - 1) {
            const sleepTime = 100 + Math.random() * 400; 
            await sleep(sleepTime);
        }
    }
    
    analyzeResults(results);
    startButton.disabled = false;
}

function analyzeResults(times) {
    const output = document.getElementById('output');
    
    const avg = times.reduce((a,b) => a+b) / times.length;
    const max = Math.max(...times);
    const min = Math.min(...times);
    const diff = max - min;
    
    const variance = times.map(t => Math.pow(t - avg, 2)).reduce((a,b) => a+b) / times.length;
    const stdDev = Math.sqrt(variance);
    
    const cv = (stdDev / avg) * 100; 
    
    // ---  ---
    let jitterEvaluation = '';
    let cvComment = ''; 
    let colorClass = '';
    let detailedAction = '';

    if(cv > 10) {
        jitterEvaluation = `–û–¢–õ–ò–ß–ù–û! –í—ã—Å–æ–∫–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å Floating-point unit (–ù–µ—Ä–æ–≤–Ω—ã–π —Ñ–æ–Ω)`;
        cvComment = `–ü—Ä–æ—Ü–µ–Ω—Ç —Ö–∞–æ—Å–∞ –≤—ã—à–µ 10% ‚Äî –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.`;
        colorClass = 'success';
        detailedAction = `‚úÖ –í–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∑–¥–∞—é—Ç —É–±–µ–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞–æ—Å –≤ —Ç–∞–π–º–∏–Ω–≥–∞—Ö.`;
    } else if (cv > 5) {
        jitterEvaluation = `–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û! –£–º–µ—Ä–µ–Ω–Ω–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å Floating-point unit.`;
        cvComment = `–•–∞–æ—Å —É–º–µ—Ä–µ–Ω–Ω—ã–π (5-10%). –ê–Ω—Ç–∏—Ñ—Ä–æ–¥ –º–æ–∂–µ—Ç –æ—Ç–±—Ä–æ—Å–∏—Ç—å —ç—Ç–æ—Ç Jitter –∫–∞–∫ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π.`;
        colorClass = 'warning';
        detailedAction = `‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –£–õ–£–ß–®–ï–ù–ò–ï! –î–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ —É–≤–µ–ª–∏—á—å—Ç–µ Jitter (–¶–µ–ª—å: > 10%).`;
    } else {
        jitterEvaluation = `–ö–†–ò–¢–ò–ß–ù–û! –ù–∏–∑–∫–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å Floating-point unit (–°–ª–∏—à–∫–æ–º —Ä–æ–≤–Ω—ã–π —Ñ–æ–Ω)`;
        cvComment = `–•–∞–æ—Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–æ–∫ (< 5%). –°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —Å—Ç–∞–±–∏–ª—å–Ω–æ–π.`;
        colorClass = 'critical';
        detailedAction = `‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û! —É–≤–µ–ª–∏—á–∏—Ç—å Jitter! –°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–π.`;
    }
    
    // ---  ---
    output.innerHTML += `
    <section class="summary-details">
        <h4>üìä –°–≤–æ–¥–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.</h4>
        <p>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: <b>${avg.toFixed(1)} –º—Å</b></p>
        <p>–†–∞–∑–±—Ä–æ—Å (Min - Max): <b>${min.toFixed(1)} –º—Å</b> ‚Äî <b>${max.toFixed(1)} –º—Å</b> (–†–∞–∑–Ω–∏—Ü–∞: <b>${diff.toFixed(1)} –º—Å</b>)</p>
        <p>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: <b>${stdDev.toFixed(1)} –º—Å</b></p>
        <hr/>
        
        <div class="evaluation-box ${colorClass}">
            <p style="font-size: 1.1em; margin-bottom: 5px;">
                <b>–û—Ü–µ–Ω–∫–∞ Jitter:</b> ${jitterEvaluation}
            </p>
            
            <p>
                <span class="cv-value ${colorClass}">–î–∏–∞–ø–∞–∑–æ–Ω: ${cv.toFixed(1)}%</span> 
                <span>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${cvComment}</span>
            </p>
        </div>
    </section>
    
    <footer style="margin-top: 20px;">
        <div>${detailedAction}</div>
    </footer>
    `;
    
    // ---  ---
    output.innerHTML += `
    <section>
        <h4>üìã –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤–∞—Ä–∏–∞—Ü–∏–π</h4>
        <table>
            <tr>
                <th>–°—Ü–µ–Ω–∞—Ä–∏–π</th>
                <th>–î–∏–∞–ø–∞–∑–æ–Ω</th>
                <th>–í—ã–≤–æ–¥</th>
            </tr>
            <tr class="critical">
                <td>‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ</td>
                <td>1.0% ‚Äì 5.0%</td>
                <td>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π Jitter (—Å–∏—Å—Ç–µ–º–∞ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞–±–∏–ª—å–Ω–∞, —Å–ª–∏—à–∫–æ–º —Ä–æ–≤–Ω—ã–π —Ñ–æ–Ω)</td>
            </tr>
            <tr class="warning">
                <td>‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è</td>
                <td>5.0% ‚Äì 10.0%</td>
                <td>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π Jitter (–Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ —Ö–∞–æ—Å–∞)</td>
            </tr>
            <tr class="success">
                <td>‚úÖ –û—Ç–ª–∏—á–Ω–æ</td>
                <td>10.0% ‚Äì 20.0%</td>
                <td>–í—ã—Å–æ–∫–∏–π Jitter (—Ö–∞–æ—Å/–Ω–µ—Ä–æ–≤–Ω–æ—Å—Ç—å)</td>
            </tr>
        </table>
    </section>
    `;
}
</script>

</body>
</html>